(self.webpackChunkrport_site=self.webpackChunkrport_site||[]).push([[31],{5858:(n,e,s)=>{"use strict";s.r(e),s.d(e,{data:()=>a});const a={key:"v-081b05f1",path:"/docs/no09-managing-tunnels.html",title:"Managing tunnels",lang:"en-DE",frontmatter:{},excerpt:"",headers:[{level:2,title:"Manage tunnel client-side",slug:"manage-tunnel-client-side",children:[]},{level:2,title:"Manage tunnel server-side",slug:"manage-tunnel-server-side",children:[{level:3,title:"List",slug:"list",children:[]},{level:3,title:"Create",slug:"create",children:[]},{level:3,title:"Delete",slug:"delete",children:[]}]}],filePathRelative:"docs/no09-managing-tunnels.md"}},6100:(n,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>p});var a=s(6252);const t=(0,a.uE)('<h1 id="managing-tunnels" tabindex="-1"><a class="header-anchor" href="#managing-tunnels" aria-hidden="true">#</a> Managing tunnels</h1><h2 id="manage-tunnel-client-side" tabindex="-1"><a class="header-anchor" href="#manage-tunnel-client-side" aria-hidden="true">#</a> Manage tunnel client-side</h2><p>Specify the desired tunnel on the command line, for example</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>rport --auth rport:password123 &lt;SERVER_IP&gt;:9999 2222:22\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Alternatively add tunnels to the configuration file <code>rport.conf</code>.</p><h2 id="manage-tunnel-server-side" tabindex="-1"><a class="header-anchor" href="#manage-tunnel-server-side" aria-hidden="true">#</a> Manage tunnel server-side</h2>',6),u=(0,a.Uk)("On the server, you can supervise and manage the attached clients through the "),l={href:"https://petstore.swagger.io/?url=https://raw.githubusercontent.com/cloudradar-monitoring/rport/master/api-doc.yml#/Clients%20and%20Tunnels",target:"_blank",rel:"noopener noreferrer"},o=(0,a.Uk)("API"),r=(0,a.Uk)("."),i=(0,a.uE)('<h3 id="list" tabindex="-1"><a class="header-anchor" href="#list" aria-hidden="true">#</a> List</h3><p><code>curl -s -u admin:foobaz http://localhost:3000/api/v1/clients</code>. <em>Use <code>jq</code> for pretty-printing json.</em> Here is an example:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>curl -s -u admin:foobaz http://localhost:3000/api/v1/clients|jq\n[\n  {\n    &quot;id&quot;: &quot;2ba9174e-640e-4694-ad35-34a2d6f3986b&quot;,\n    &quot;name&quot;: &quot;My Test VM&quot;,\n    &quot;os&quot;: &quot;Linux my-devvm-v3 5.4.0-37-generic #41-Ubuntu SMP Wed Jun 3 18:57:02 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux&quot;,\n    &quot;os_arch&quot;: &quot;amd64&quot;,\n    &quot;os_family&quot;: &quot;debian&quot;,\n    &quot;os_kernel&quot;: &quot;linux&quot;,\n    &quot;os_full_name&quot;: &quot;Debian&quot;,\n    &quot;os_version&quot;: &quot;5.4.0-37&quot;,\n    &quot;os_virtualization_system&quot;:&quot;KVM&quot;,\n    &quot;os_virtualization_role&quot;:&quot;guest&quot;,\n    &quot;cpu_family&quot;:&quot;59&quot;,\n    &quot;cpu_model&quot;:&quot;6&quot;,\n    &quot;cpu_model_name&quot;:&quot;Intel(R) Xeon(R) Silver 4110 CPU @ 2.10GHz&quot;,\n    &quot;cpu_vendor&quot;:&quot;Intel&quot;,\n    &quot;num_cpus&quot;:16,\n    &quot;mem_total&quot;:67020316672,\n    &quot;timezone&quot;:&quot;UTC (UTC+00:00)&quot;,\n    &quot;hostname&quot;: &quot;my-devvm-v3&quot;,\n    &quot;ipv4&quot;: [\n      &quot;192.168.3.148&quot;\n    ],\n    &quot;ipv6&quot;: [\n      &quot;fe80::20c:29ff:fec8:b1f&quot;\n    ],\n    &quot;tags&quot;: [\n      &quot;Linux&quot;,\n      &quot;Office Berlin&quot;\n    ],\n    &quot;version&quot;: &quot;0.1.6&quot;,\n    &quot;address&quot;: &quot;87.123.136.***:63552&quot;,\n    &quot;tunnels&quot;: []\n  },\n   {\n    &quot;id&quot;: &quot;aa1210c7-1899-491e-8e71-564cacaf1df8&quot;,\n    &quot;name&quot;: &quot;Random Rport Client&quot;,\n    &quot;os&quot;: &quot;Linux alpine-3-10-tk-01 4.19.80-0-virt #1-Alpine SMP Fri Oct 18 11:51:24 UTC 2019 x86_64 Linux&quot;,\n    &quot;os_arch&quot;: &quot;amd64&quot;,\n    &quot;os_family&quot;: &quot;alpine&quot;,\n    &quot;os_kernel&quot;: &quot;linux&quot;,\n    &quot;os_full_name&quot;: &quot;Debian&quot;,\n    &quot;os_version&quot;: &quot;5.4.0-37&quot;,\n    &quot;os_virtualization_system&quot;:&quot;KVM&quot;,\n    &quot;os_virtualization_role&quot;:&quot;guest&quot;,\n    &quot;cpu_family&quot;:&quot;59&quot;,\n    &quot;cpu_model&quot;:&quot;6&quot;,\n    &quot;cpu_model_name&quot;:&quot;Intel(R) Xeon(R) Silver 4110 CPU @ 2.10GHz&quot;,\n    &quot;cpu_vendor&quot;:&quot;Intel&quot;,\n    &quot;num_cpus&quot;:16,\n    &quot;mem_total&quot;:67020316672,\n    &quot;timezone&quot;:&quot;UTC (UTC+00:00)&quot;,\n    &quot;hostname&quot;: &quot;alpine-3-10-tk-01&quot;,\n    &quot;ipv4&quot;: [\n      &quot;192.168.122.117&quot;\n    ],\n    &quot;ipv6&quot;: [\n      &quot;fe80::b84f:aff:fe59:a0ba&quot;\n    ],\n    &quot;tags&quot;: [\n      &quot;Linux&quot;,\n      &quot;Datacenter 1&quot;\n    ],\n    &quot;version&quot;: &quot;0.1.6&quot;,\n    &quot;address&quot;: &quot;88.198.189.***:43206&quot;,\n    &quot;tunnels&quot;: [\n      {\n        &quot;lhost&quot;: &quot;0.0.0.0&quot;,\n        &quot;lport&quot;: &quot;2222&quot;,\n        &quot;rhost&quot;: &quot;0.0.0.0&quot;,\n        &quot;rport&quot;: &quot;22&quot;,\n        &quot;id&quot;: &quot;1&quot;\n      }\n    ]\n  }\n]\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br></div></div><p>The above example shows one client connected with an active tunnel. The second client is in standby mode.</p><h3 id="create" tabindex="-1"><a class="header-anchor" href="#create" aria-hidden="true">#</a> Create</h3><p>Now use <code>PUT /api/v1/clients/{id}/tunnels?local={port}&amp;remote={port}</code> to request a new tunnel for a client. For example,</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>CLIENTID=2ba9174e-640e-4694-ad35-34a2d6f3986b\nLOCAL_PORT=4000\nREMOTE_PORT=22\ncurl -u admin:foobaz -X PUT &quot;http://localhost:3000/api/v1/clients/$CLIENTID/tunnels?local=$LOCAL_PORT&amp;remote=$REMOTE_PORT&quot;|jq\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>The ports are defined from the servers&#39; perspective. &quot;Local&quot; refers to the local ports of the rport server. &quot;Remote&quot; refers to the ports and interfaces of the client. The above example opens port 4000 on the rport server and forwards to the port 22 of the client.</p><p>Using</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>curl -s -u admin:foobaz -X GET &quot;http://localhost:3000/api/v1/clients&quot;\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>or</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>curl -s -u admin:foobaz -X GET &quot;http://localhost:3000/api/v1/clients&quot;|jq &quot;.data[] | select(.id==\\&quot;$CLIENTID\\&quot;)|.tunnels&quot;\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>confirms the tunnel has been established.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&quot;tunnels&quot;: [\n      {\n        &quot;lhost&quot;: &quot;0.0.0.0&quot;,\n        &quot;lport&quot;: &quot;4000&quot;,\n        &quot;rhost&quot;: &quot;0.0.0.0&quot;,\n        &quot;rport&quot;: &quot;22&quot;,\n        &quot;id&quot;: &quot;1&quot;\n      }\n    ]\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>The above example makes the tunnel available without restrictions. Learn more about access control (ACL) below.</p><p>If you omit the local port a random free port on the rport server is selected. For example,</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>curl -s -u admin:foobaz -X PUT &quot;http://localhost:3000/api/v1/clients/$CLIENTID/tunnels?remote=22&quot;|jq\n{\n  &quot;data&quot;: {\n    &quot;success&quot;: 1,\n    &quot;tunnel&quot;: {\n      &quot;lhost&quot;: &quot;0.0.0.0&quot;,\n      &quot;lport&quot;: &quot;38126&quot;,\n      &quot;rhost&quot;: &quot;0.0.0.0&quot;,\n      &quot;rport&quot;: &quot;22&quot;,\n      &quot;lport_random&quot;: true,\n      &quot;id&quot;: &quot;4&quot;\n    }\n  }\n}\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>The rport client is not limited to establish tunnels only to the system it runs on. You can use it as a jump host to create tunnels to foreign systems too.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>CLIENTID=2ba9174e-640e-4694-ad35-34a2d6f3986b\nLOCAL_PORT=4001\nREMOTE_PORT=192.168.178.1:80\ncurl -u admin:foobaz -X PUT &quot;http://localhost:3000/api/v1/clients/$CLIENTID/tunnels?local=$LOCAL_PORT&amp;remote=$REMOTE_PORT&quot;\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>This example forwards port 4001 of the rport server to port 80 of <code>192.168.178.1</code> using the rport client in the middle.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&quot;tunnels&quot;: [\n      {\n        &quot;lhost&quot;: &quot;0.0.0.0&quot;,\n        &quot;lport&quot;: &quot;4001&quot;,\n        &quot;rhost&quot;: &quot;192.168.178.1&quot;,\n        &quot;rport&quot;: &quot;80&quot;,\n        &quot;id&quot;: &quot;1&quot;\n      }\n    ]\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Idle tunnels are automatically closed after 5 minutes. You can change <code>idle-timeout-minutes</code> parameter to provide a custom value in minutes.</p><p>For example,</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>CLIENTID=2ba9174e-640e-4694-ad35-34a2d6f3986b\nLOCAL_PORT=4000\nREMOTE_PORT=22\ncurl -u admin:foobaz -X PUT &quot;http://localhost:3000/api/v1/clients/$CLIENTID/tunnels?local=$LOCAL_PORT&amp;remote=$REMOTE_PORT&amp;idle-timeout-minutes=10\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>If no <code>idle-timeout-minutes</code> parameter is given, the default idle timeout will be 5 minutes. To disable auto-closing of tunnels, you should provide <code>skip-idle-timeout</code> parameter, e.g.:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>CLIENTID=2ba9174e-640e-4694-ad35-34a2d6f3986b\nLOCAL_PORT=4000\nREMOTE_PORT=22\ncurl -u admin:foobaz -X PUT &quot;http://localhost:3000/api/v1/clients/$CLIENTID/tunnels?local=$LOCAL_PORT&amp;remote=$REMOTE_PORT&amp;skip-idle-timeout=1\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Please note, that you should not use <code>skip-idle-timeout</code> and <code>idle-timeout-minutes</code> in the same request, what will cause a conflicting parameter error.</p><h4 id="tunnel-access-control" tabindex="-1"><a class="header-anchor" href="#tunnel-access-control" aria-hidden="true">#</a> Tunnel access control</h4><p>To increase the security of remote access, you can control how it is allowed to use a tunnel by limiting the tunnel usage to ip v4 addresses or network segments (ipv6 is not supported yet).</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>CLIENTID=2ba9174e-640e-4694-ad35-34a2d6f3986b\nLOCAL_PORT=4000\nREMOTE_PORT=22\nACL=213.90.90.123,189.20.90.0/24\ncurl -u admin:foobaz -X PUT &quot;http://localhost:3000/api/v1/clients/$CLIENTID/tunnels?local=$LOCAL_PORT&amp;remote=$REMOTE_PORT&amp;acl=$ACL&quot;\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>A list of single ip-addresses or network segments separated by a comma is accepted.</p><h3 id="delete" tabindex="-1"><a class="header-anchor" href="#delete" aria-hidden="true">#</a> Delete</h3><p>Using a DELETE request with the tunnel id allows terminating a tunnel.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>CLIENTID=2ba9174e-640e-4694-ad35-34a2d6f3986b\nTUNNELID=1\ncurl -u admin:foobaz -X DELETE &quot;http://localhost:3000/api/v1/clients/$CLIENTID/tunnels/$TUNNELID&quot;\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div>',34),p={render:function(n,e){const s=(0,a.up)("OutboundLink");return(0,a.wg)(),(0,a.j4)(a.HY,null,[t,(0,a.Wm)("p",null,[u,(0,a.Wm)("a",l,[o,(0,a.Wm)(s)]),r]),i],64)}}}}]);